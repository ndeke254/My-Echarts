---
output: 
  bookdown::html_document2:
    number_sections: true
    toc: true
    toc_float: true
    toc_depth: 2
    theme: spacelab
    code_folding: hide
    css: "style.css"
---
<div style="text-align: center; font-weight: bold; font-size: 20px; padding-top: 30px;
">
<h1> ECHARTS GRAPHS </h1>
</div>

```{=html}
<!-- 
set global chunk options:

`message = FALSE` prevents messages that are generated by code from appearing in the finished file.

`warning = FALSE` prevents warnings that are generated by code from appearing in the finished.
-->
```
```{r setup, include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```


```{r}
#load libraries
library(tidyverse)
library(echarts4r)
library(readxl)
library(fontawesome)
#import data
counties_kenya <-read_excel("counties_kenya.xlsx")
```
<div style="text-align:center;">
Jefferson Ndeke  
2022-08-03
<div>
<li> [`r fa("twitter", fill = "darkgreen")`](https://twitter.com/jefferson_ndeke "Twitter") </li>
<li> [`r fa("linkedin", fill = "darkgreen")`](https://www.linkedin.com/in/jefferson-ndeke-027062202/ "LinkedIn")
</li>
<li> [`r fa("github", fill = "darkgreen")`](https://github.com/ndeke254 "Github")
</li>
</div>
</div>

# Introduction

**I find the [Echarts4r package](https://echarts4r.john-coene.com) in R useful in producing not only smart but also lively and interactive graphical representations. I use javascript from [Echarts](https://echarts.apache.org/en/index.html) to further extend the available functionality. I introduce any javascript functionality into R by using [htmlwidgets::JS](https://www.htmlwidgets.org/)**

# Graphs {.tabset .tabset-fade}

**Scroll inside the graph to zoom**

## Normal bar

```{r}
#prepare data
data <- counties_kenya |> arrange(Sno,decreasing=FALSE)
data$cast_p_2013 <-  round(data$cast_p_2013,2)
data$cast_p_2017 <-  round(data$cast_p_2017,2)
data <- data |> rename(`2013`=cast_p_2013,`2017`=cast_p_2017)
data <- data |>  pivot_longer(cols=c("2013","2017"), names_to = "Year", values_to = "Voter turn out",values_drop_na =TRUE)
#radial gradient background
radial_gradient <- htmlwidgets::JS(
  "new echarts.graphic.RadialGradient(
    0.2, 0.7, 0.9,
    [
     {offset: 0, color: '#f7f8fa'},   
    { offset: 1, color: '#cdd0d5'}
    ])")

#plot
data |> 
  arrange(desc(`Area (km2)`)) |> #arrange in descending order
  e_charts(name) |>
  e_bar(`Area (km2)`,
        showBackground=TRUE,
        emphasis = list(
          focus = "item"),
        itemStyle=list(
          shadowBlur=1, #customise bars
          shadowColor='#4f1721',
          shadowOffsetY=2))|>
  e_animation(duration = 4000)|> #duration in plot animation
  e_tooltip(trigger='item',backgroundColor='#e6e6e6')|> #customise tool tip 
  e_axis_labels(x='Counties',y = 'Area in km2') |> #axis
  e_title(text=paste('AREA COVERED BY EACH COUNTY IN KENYA'),
          subtext="Analyst: Jefferson Ndeke  Data: IEBC Kenya",
          left='center',top=10,
          sublink = 'https://github.com/ndeke254') |> #title
  e_x_axis(axisLabel = list(interval = 0, rotate = 45)) |>  # rotate
  e_toolbox_feature(feature = c("restore","saveAsImage"),type='bar') |> #features to interact
  e_legend(orient = 'vertical',right = '2', top = '7%') |>
  e_datazoom(type='inside') |> #zoom to view
  e_grid(show=TRUE,backgroundColor=radial_gradient)|> #grid
  e_color(background='#cdd0d5') |>
  e_x_axis(axisTick=list(
    alignWithLabel= TRUE
  ),
  splitLine=list(
    lineStyle=list(
      type='dashed'))) |>
  e_y_axis(scale=TRUE,
           splitLine=list(
             lineStyle=list(
               type='dashed')))

```
## Comparative bar
``` {r}
#radial gradient color
radial_gradient <- htmlwidgets::JS(
  "new echarts.graphic.RadialGradient(
    0.5, 0.7, 1,
    [
     {offset: 0, color: '#ffffff'},   
    { offset: 1, color: '#cdd0d5'}
    ])")

#plot the bar graph
data|> 
  group_by(Year) |> 
  e_charts(name) |>
  e_bar(`Voter turn out`,
        showBackground=TRUE,
        emphasis = list(
          focus = "series"),
          itemStyle=list(
          shadowBlur=1,
          shadowColor='#4f1721',
          shadowOffsetY=2))|>
  e_animation(duration = 4000)|>
  e_tooltip(trigger='axis',backgroundColor='#e6e6e6') |>
  e_axis_labels(x='Counties',y = '% Voter turn out') |> 
  e_title(text=paste('VOTER TURN OUT FOR 2013 & 2017 GENERAL ELECTIONS PER COUNTY'),subtext="Analyst: Jefferson Ndeke  Data: IEBC Kenya",left='center',top=1,sublink = 'https://github.com/ndeke254') |>
  e_x_axis(axisLabel = list(interval = 0, rotate = 45)) |>  # rotate
  e_toolbox_feature(feature = c("restore","saveAsImage"),type='bar') |>
  e_legend(orient = 'vertical',right = '5', top = '15%') |>
  e_datazoom(type='inside') |>
  e_aria(enabled = TRUE, decal = list(show = TRUE))|>
  e_grid(show=TRUE,backgroundColor=radial_gradient)|>
  e_color(background='#cdd0d5') |>
  e_x_axis(axisTick=list(
    alignWithLabel= TRUE
  ),
  splitLine=list(
    lineStyle=list(
      type='dashed'))) |>
  e_y_axis(scale=TRUE,
           splitLine=list(
             lineStyle=list(
               type='dashed')))
```

## Scatter

```{r}
#prepare data1 & data2
data1 <- counties_kenya |> select(name,Sno,cast_p_2013,reg_voters_2013)
data2 <-  counties_kenya |> select(name,Sno,cast_p_2017, reg_voters_2017)
data1 <- data1 |> add_column(Year=c(rep(2013,47)))
data2 <- data2 |> add_column(Year=c(rep(2017,47)))
data1 <- data1 |> rename(`% Cast votes`=cast_p_2013,`Registered Votes`=reg_voters_2013)      
data2 <- data2 |> rename(`% Cast votes`=cast_p_2017,`Registered Votes`=reg_voters_2017)  

#join the two
final <- dplyr::full_join(data1,data2)
final$size <- rep(log(counties_kenya$`Area (km2)`),2)

#scatter plot
final$`% Cast votes` <- final$`% Cast votes`|> round(2)
  radial_gradient <- htmlwidgets::JS(
    "new echarts.graphic.RadialGradient(
    0.1, 0.2, 0.7,
    [
     {offset: 0, color: '#f7f8fa'},   
    { offset: 1, color: '#cdd0d5'}
    ])")
  #scatter plot
  final |> 
  group_by(Year) |> 
  e_charts(`Registered Votes`)|>
  e_scatter(`% Cast votes`,
            size = size,
            bind = name,
            emphasis = list(
              focus = "item"),
            itemStyle=list(
              shadowBlur=8,
              shadowColor='#4f1721',
              shadowOffsetY=3)) |> 
    e_tooltip(backgroundColor='#e6e6e6',formatter = htmlwidgets::JS("
      function(params){
        return('<strong>' + params.name + 
                '</strong><br />Registered: ' + params.value[0] + 
                '<br />Cast: ' + params.value[1]) +'</> %' 
                }
    ")) |>
    e_animation(duration = 4000)|>
    e_axis_labels(x='Registered Voters',y = '% cast votes') |> 
    e_title(text=paste('VOTES CAST AGAINST VOTERS REGISTERED'),subtext="Analyst: Jefferson Ndeke  Data: IEBC Kenya",left='center',top=1,
           sublink = 'https://github.com/ndeke254')|> 
    e_toolbox_feature(feature = c("restore","saveAsImage")) |>
    e_legend(orient = 'vertical',right = '15', top = '15%') |>
    e_datazoom(type='inside') |>
    e_grid(show=TRUE,backgroundColor=radial_gradient)|>
    e_color(background='#cdd0d5') |>
    e_x_axis(splitLine=list(
      lineStyle=list(
        type='dashed'))) |>
    e_y_axis(scale=TRUE,
             splitLine=list(
               lineStyle=list(
                 type='dashed')))
```

## Line

```{r}
#prepare data
data <- counties_kenya |> select(name,Sno,cast_p_2013,cast_p_2017)
data <- data |> arrange(Sno,decreasin=FALSE)
data$cast_p_2013 <-  round(data$cast_p_2013,2)
data$cast_p_2017 <-  round(data$cast_p_2017,2)
data <- data |> rename(`2013`=cast_p_2013,`2017`=cast_p_2017)
data <- data |>  pivot_longer(cols=c("2013","2017"), names_to = "Year", values_to = "Voter turn out",values_drop_na =TRUE)
#radial background color
radial_gradient <- htmlwidgets::JS(
  "new echarts.graphic.RadialGradient(
    0.5, 0.3, 0.8,
    [
     {offset: 0, color: '#ffffff'},   
    { offset: 1, color: '#cdd0d5'}
    ])")
#line plot
data |> 
  group_by(Year) |> 
  e_charts(name) |>
  e_line(`Voter turn out`,showBackground=TRUE,
         emphasis = list(
           focus = "series"),
         itemStyle=list(
           shadowBlur=1,
           shadowColor='#4f1721',
           shadowOffsetY=2))|>
  e_animation(duration = 4000)|>
  e_tooltip(trigger='axis') |>  
  e_axis_labels(x='Counties',y = '% Voter turn out') |> 
  e_title(paste('VOTER TURN OUT FOR 2013 & 2017 GENERAL ELECTIONS PER COUNTY'),left='center',top=10,subtext="Analyst: Jefferson Ndeke  Data: IEBC Kenya",left='center',top=1,sublink = 'https://github.com/ndeke254')|>
  e_x_axis(axisLabel = list(interval = 0, rotate = 45)) |>  # rotate
  e_toolbox_feature(feature = c("restore","saveAsImage"))  |>
  e_legend(orient = 'vertical',right = '5', top = '15%') |>
  e_datazoom(type='inside') |>
  e_aria(enabled = TRUE, decal = list(show = TRUE))|>
  e_grid(show=TRUE,backgroundColor=radial_gradient)|>
  e_color(background='#cdd0d5') |>
  e_x_axis(axisTick=list(
    alignWithLabel= TRUE
  ),
  splitLine=list(
    lineStyle=list(
      type='dashed'))) |>
  e_y_axis(scale=TRUE,
           splitLine=list(
             lineStyle=list(
               type='dashed')))

```
 
 
# Conclusion

**The bridging of R and javascript proves in marvelous the generation of graphical plots**

<!-- back to top functionality: -->

<div style="text-align:right; padding-top:120px;">
Back to top [`r fa("arrow-up", fill = "darkgreen")`](#)
</div>

